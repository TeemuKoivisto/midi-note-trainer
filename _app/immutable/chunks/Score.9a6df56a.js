import{S as Q,i as U,s as J,O as ne,e as A,H as F,a as C,b as E,I,d as y,f as S,L as B,g as W,h as V,J as j,p as re,t as D,l as $,K,M as X,N as G,P as q,m as te,o as se,Q as ue,r as de,F as he}from"./vendor_svelte.4831b486.js";import{F as v}from"./vendor_vexflow.2dfca40b.js";import{p as me,g as oe,c as Y,G as H,a as L,b as ge,s as be,d as pe,t as we,e as ae,F as _e,S as ve}from"./3.19f3041d.js";import{d as ye,a as Se}from"./vendor.13a9dfeb.js";function Ne(i){let t,s,l,a,n,f,g;return l=new ne({props:{icon:ye,width:32}}),{c(){t=A("div"),s=A("button"),F(l.$$.fragment),this.h()},l(e){t=C(e,"DIV",{class:!0});var c=E(t);s=C(c,"BUTTON",{class:!0});var p=E(s);I(l.$$.fragment,p),p.forEach(y),c.forEach(y),this.h()},h(){S(s,"class","flex items-center justify-center rounded px-1 py-1 hover:bg-gray-200"),S(t,"class",a=`${i[2].class||""}`),B(t,"hidden",!i[0])},m(e,c){W(e,t,c),V(t,s),j(l,s,null),n=!0,f||(g=re(s,"click",i[1]),f=!0)},p(e,[c]){(!n||c&4&&a!==(a=`${e[2].class||""}`))&&S(t,"class",a),(!n||c&5)&&B(t,"hidden",!e[0])},i(e){n||(D(l.$$.fragment,e),n=!0)},o(e){$(l.$$.fragment,e),n=!1},d(e){e&&y(t),K(l),f=!1,g()}}}function ke(i,t,s){let l,a,n,f;X(i,me,e=>s(4,a=e)),X(i,oe,e=>s(5,n=e)),X(i,Y,e=>s(3,f=e));function g(){var c;const e=f;e instanceof H&&n==="waiting"?a==null||a.playChord(e.current.notes.map(p=>p.midi)):e instanceof H?a==null||a.playChord((((c=e.latestGuess.target)==null?void 0:c.notes)||[]).map(p=>p.midi)):e instanceof L&&n==="waiting"?a==null||a.noteOn(e.current):e instanceof L&&(a==null||a.noteOn(e.latestGuess.target||0))}return i.$$set=e=>{s(2,t=G(G({},t),q(e)))},i.$$.update=()=>{i.$$.dirty&8&&s(0,l=f instanceof H||f instanceof L)},t=q(t),[l,g,t,f]}class Ae extends Q{constructor(t){super(),U(this,t,ke,Ne,J,{})}}function Ce(i){let t,s,l,a,n,f,g;return l=new ne({props:{icon:Se,width:32}}),{c(){t=A("div"),s=A("button"),F(l.$$.fragment),this.h()},l(e){t=C(e,"DIV",{class:!0});var c=E(t);s=C(c,"BUTTON",{class:!0});var p=E(s);I(l.$$.fragment,p),p.forEach(y),c.forEach(y),this.h()},h(){S(s,"class","flex items-center justify-center rounded px-1 py-1 hover:bg-gray-200"),S(t,"class",a=`${i[2].class||""}`),B(t,"hidden",!i[0])},m(e,c){W(e,t,c),V(t,s),j(l,s,null),n=!0,f||(g=re(s,"click",i[1]),f=!0)},p(e,[c]){(!n||c&4&&a!==(a=`${e[2].class||""}`))&&S(t,"class",a),(!n||c&5)&&B(t,"hidden",!e[0])},i(e){n||(D(l.$$.fragment,e),n=!0)},o(e){$(l.$$.fragment,e),n=!1},d(e){e&&y(t),K(l),f=!1,g()}}}function Ee(i,t,s){let l;X(i,Y,n=>s(0,l=n));function a(){ge.clearGame()}return i.$$set=n=>{s(2,t=G(G({},t),q(n)))},t=q(t),[l,a,t]}class Te extends Q{constructor(t){super(),U(this,t,Ee,Ce,J,{})}}function Ve(i){let t,s,l,a,n,f,g,e,c,p;return f=new Ae({props:{class:"mr-2"}}),e=new Te({}),{c(){t=A("section"),s=A("div"),l=te(),a=A("div"),n=A("div"),F(f.$$.fragment),g=te(),F(e.$$.fragment),this.h()},l(u){t=C(u,"SECTION",{class:!0});var N=E(t);s=C(N,"DIV",{id:!0}),E(s).forEach(y),l=se(N),a=C(N,"DIV",{class:!0});var M=E(a);n=C(M,"DIV",{class:!0});var x=E(n);I(f.$$.fragment,x),g=se(x),I(e.$$.fragment,x),x.forEach(y),M.forEach(y),N.forEach(y),this.h()},h(){S(s,"id","output"),S(n,"class","flex"),S(a,"class","absolute left-0 top-[18.5rem]"),S(t,"class",c=`${i[1].class||""} relative`)},m(u,N){W(u,t,N),V(t,s),i[2](s),V(t,l),V(t,a),V(a,n),j(f,n,null),V(n,g),j(e,n,null),p=!0},p(u,[N]){(!p||N&2&&c!==(c=`${u[1].class||""} relative`))&&S(t,"class",c)},i(u){p||(D(f.$$.fragment,u),D(e.$$.fragment,u),p=!0)},o(u){$(f.$$.fragment,u),$(e.$$.fragment,u),p=!1},d(u){u&&y(t),i[2](null),K(f),K(e)}}}function xe(i,t,s){const{Accidental:l,Formatter:a,Renderer:n,Stave:f,StaveNote:g}=v;let e=200,c,p,u;const N=ue([Y,oe,be,pe,we],([o,w,d,b,h])=>({game:o,guessed:w,scale:d,played:b,target:h}));de(()=>{x(),N.subscribe(o=>ce(o))});function M(o,w){const d=w.flats>0?w.flats:w.sharps,b=o.flats>0?o.flats:o.sharps,h=o.flats>0?"b":"#",m=(w.flats>0?_e:ve).slice(0,d),r=m.find(T=>T===o.note.slice(0,2))?b-1:b,_=o.note.length===1&&m.find(T=>T.charAt(0)===o.note.charAt(0));return{...o,parts:[o.note.charAt(0),`${_?"n":h.repeat(r)}`,ae(o.midi)]}}function x(){p=new n(c,n.Backends.SVG),p.resize(732,360),u=p.getContext(),u.scale(2,2),new v.TickContext;const o=new f(0,0,e).addClef("treble").addKeySignature("B"),w=new f(0,60,e).addClef("bass").addKeySignature("B"),d=[new g({keys:["g#/4"],duration:"q"}),new g({keys:["b/4"],duration:"qr"}),new g({keys:["c/4"],duration:"q"}),new g({keys:["a/4","c/5","e/5"],duration:"q"})],b=[new g({clef:"bass",keys:["f/3"],duration:"q"}),new g({clef:"bass",keys:["b/3"],duration:"qr"}),new g({clef:"bass",keys:["b/2"],duration:"q"}),new g({clef:"bass",keys:["c/3","e/3","g/3"],duration:"q"})];d[0].addModifier(new l("#"),0);const h=new v.Voice({num_beats:4,beat_value:4}).addTickables(d),m=new v.Voice({num_beats:4,beat_value:4}).addTickables(b),r=Math.max(o.getNoteStartX(),w.getNoteStartX());o.setNoteStartX(r),w.setNoteStartX(r);const _=new v.Formatter;_.joinVoices([h]),_.joinVoices([m]),_.format([h,m],e-10-r),h.draw(u,o),m.draw(u,w),o.setContext(u).draw(),w.setContext(u).draw()}function Z(o,w){const d=[],b=[];for(let m=0;m<o.length;m+=1){const r=o[m],_=ae(r.midi),T="color"in r&&r.color!=="default"?r.color==="correct"?"rgb(34, 197, 94)":"red":void 0,O={...M(o[m],w),color:T};_<4?d.push(O):b.push(O)}const h=[];if(d.length>0){const m=new v.StaveNote({clef:"bass",keys:d.map(r=>`${r.parts[0]}${r.parts[1]}/${r.parts[2]}`),duration:"w"}).setAttribute("clef","bass");d.forEach((r,_)=>{r.parts[1]&&m.addModifier(new l(r.parts[1]),_),r.color&&m.setStyle({fillStyle:r.color})}),h.push(m)}if(b.length>0){const m=new v.StaveNote({clef:"treble",keys:b.map(r=>`${r.parts[0]}${r.parts[1]}/${r.parts[2]}`),duration:"w"}).setAttribute("clef","treble");b.forEach((r,_)=>{r.parts[1]&&m.addModifier(new l(r.parts[1]),_),r.color&&m.setStyle({fillStyle:r.color})}),h.push(m)}return h}function le(o,w){const d=[],b=[];return o.forEach(h=>{h.getAttribute("clef")==="treble"?d.push(h):b.push(h)}),d.length===0&&b.length>0&&w.length>0?d.push(new v.StaveNote({clef:"treble",keys:["G/4"],duration:"w"}).setStyle({fillStyle:"#fff"})):b.length===0&&d.length>0&&w.length>0&&b.push(new v.StaveNote({clef:"bass",keys:["F/3"],duration:"w"}).setStyle({fillStyle:"#fff"})),d.push(...w.filter(h=>h.getAttribute("clef")==="treble")),b.push(...w.filter(h=>h.getAttribute("clef")==="bass")),[d,b]}function ce({game:o,guessed:w,scale:d,played:b,target:h}){const m=d.majorSignature.replaceAll("♭","b").replaceAll("♯","#");e=200+Math.max(d.flats,d.sharps)*10,u.clear(),u.scale(.5,.5);const r=new f(0,0,e).addClef("treble").addKeySignature(m),_=new f(0,60,e).addClef("bass"),T=Z(h,d),O=Z(b,d),[P,R]=le(T,O),k=[];P.length>0&&k.push(new v.Voice({num_beats:4,beat_value:4}).setMode(2).addTickables(P)),R.length>0&&k.push(new v.Voice({num_beats:4,beat_value:4}).setMode(2).addTickables(R));const z=Math.max(r.getNoteStartX(),_.getNoteStartX());r.setNoteStartX(z),_.setNoteStartX(z);const ee=new v.Formatter;k.forEach(fe=>{ee.joinVoices([fe])}),k.length>0&&ee.format(k,e-10-z),P.length>0&&k[0].draw(u,r),R.length>0&&k[k.length-1].draw(u,_),r.setContext(u).draw(),_.setContext(u).draw()}function ie(o){he[o?"unshift":"push"](()=>{c=o,s(0,c)})}return i.$$set=o=>{s(1,t=G(G({},t),q(o)))},t=q(t),[c,t,ie]}class Xe extends Q{constructor(t){super(),U(this,t,xe,Ve,J,{})}}export{Xe as default};
