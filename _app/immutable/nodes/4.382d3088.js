var L=Object.defineProperty;var w=(o,t,e)=>t in o?L(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var s=(o,t,e)=>(w(o,typeof t!="symbol"?t+"":t,e),e);import{s as y,n as d,o as _}from"../chunks/scheduler.e80da8ef.js";import{S as T,i as R,g as p,s as q,h as m,y as x,c as C,j as U,f as u,k as v,a as g,x as b,A as F}from"../chunks/index.3d76737d.js";const k=""+new URL("../assets/21.dc3c2e85.mp3",import.meta.url).href,O=""+new URL("../assets/33.1b1ff663.mp3",import.meta.url).href,S=""+new URL("../assets/45.b8744b82.mp3",import.meta.url).href,P=""+new URL("../assets/57.09c40d98.mp3",import.meta.url).href,M=""+new URL("../assets/69.11c384d7.mp3",import.meta.url).href,E=""+new URL("../assets/81.bc7d85dc.mp3",import.meta.url).href,H=""+new URL("../assets/93.a39f1834.mp3",import.meta.url).href,I=""+new URL("../assets/105.0ce83a41.mp3",import.meta.url).href,X=""+new URL("../assets/damper.391ddc72.mp3",import.meta.url).href,$=""+new URL("../assets/Piano Impulse6.43259355.mp3",import.meta.url).href;class j{constructor(t,e,n){s(this,"context");s(this,"urlList");s(this,"onload");s(this,"bufferList",[]);s(this,"loadCount",0);this.context=t,this.urlList=e,this.onload=n}loadBuffer(t,e){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer";const i=this;n.onload=function(){i.context.decodeAudioData(n.response,function(a){if(!a){console.error("error decoding file data: "+t);return}i.bufferList[e]=a,++i.loadCount==i.urlList.length&&i.onload(i.bufferList)})},n.onerror=function(){console.error("BufferLoader: XHR error")},n.send()}load(){for(let t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)}}class D{constructor(t,e){s(this,"noteA");s(this,"noteB");s(this,"gainA");s(this,"gainB");s(this,"gain");s(this,"biquadFilter");s(this,"damp");s(this,"piano");this.piano=e,this.noteA=e.context.createBufferSource(),this.noteB=e.context.createBufferSource(),this.gainA=e.context.createGain(),this.gainB=e.context.createGain(),this.gain=e.context.createGain(),this.biquadFilter=e.context.createBiquadFilter(),this.biquadFilter.type="lowpass",this.biquadFilter.connect(e.directGain),this.gain.connect(this.biquadFilter),this.gainA.connect(this.gain),this.noteA.connect(this.gainA),this.gainB.connect(this.gain),this.noteB.connect(this.gainB),t<90&&(this.damp=e.context.createBufferSource(),this.damp.buffer=e.damper,this.damp.connect(this.piano.directGain))}on(t,e,n,i,a,h,c,f){this.noteA.buffer=this.piano.bufferlists[t],this.noteA.playbackRate.value=n,this.biquadFilter.frequency.value=a,this.gainA.gain.value=h,this.gain.gain.value=f,this.piano.bufferlists[e]?(this.noteB.buffer=this.piano.bufferlists[e],this.noteB.playbackRate.value=i,this.gainB.gain.value=c,this.noteB.start(0)):this.noteB=null,this.noteA.start(0)}off(){this.noteA.stop(0),this.noteB.stop(0)}}class z{constructor(t){s(this,"context");s(this,"convolver");s(this,"directGain");s(this,"convGain");s(this,"convGainAfter");s(this,"bufferlists",[]);s(this,"damper");s(this,"sus",!1);s(this,"sustained",[]);s(this,"notes",{});s(this,"bufferLoader");this.context=t,this.convolver=t.createConvolver(),this.directGain=t.createGain(),this.convGain=t.createGain(),this.convGainAfter=t.createGain(),this.convGain.connect(this.convolver),this.convolver.connect(this.convGainAfter),this.convGainAfter.connect(t.destination),this.directGain.connect(t.destination),this.directGain.connect(this.convGain),this.directGain.gain.value=.5,this.convGain.gain.value=0,this.convGainAfter.gain.value=0,this.bufferLoader=new j(t,[k,O,S,P,M,E,H,I,X,$],e=>{this.bufferlists=e,this.damper=e[8],this.convolver.buffer=e[9]}),this.bufferLoader.load()}noteOn(t,e){if(t<109&&t>20){this.notes[t]&&(this.notes[t].gain.gain.setTargetAtTime(0,this.context.currentTime,1.1),this.notes[t].noteA.stop(this.context.currentTime+2),this.notes[t].noteB.stop(this.context.currentTime+2),this.notes[t].damp=void 0,this.sustained.splice(this.sustained.indexOf(t),1));const n=Math.floor((t-21)/12),i=n+1,a=n*12+21,h=2**((t-69)/12)*440,c=e/127;let f=h*(2-(t-21)/50)+3*h*c;t<60&&(f=440*(3-(60-21)/50)+3*h*c);const r=2,l=Math.pow(2,(t-a)/12),A=0,G=0,B=c**1.4;this.notes[t]=new D(t,this),this.notes[t].on(n,i,l,A,f,r,G,B)}}noteOff(t){this.sus?this.sustained.push(t):(t<90&&(this.notes[t].gain.gain.setTargetAtTime(0,this.context.currentTime+.03,.08),this.notes[t].noteA.stop(this.context.currentTime+2),this.notes[t].noteB.stop(this.context.currentTime+2),this.notes[t].damp.start(0)),delete this.notes[t])}sustain(t){if(t==127)this.sus=!0,this.convGain.gain.value=1,this.convGainAfter.gain.value=1;else if(t==0){this.sus=!1,this.convGain.gain.value=0,this.convGainAfter.gain.value=0;for(let e=0;e<this.sustained.length;e++)this.notes[this.sustained[e]]&&this.noteOff(this.sustained[e]);this.sustained=[]}}}function J(o){let t,e="Synth",n,i,a,h="Play",c,f;return{c(){t=p("h1"),t.textContent=e,n=q(),i=p("section"),a=p("button"),a.textContent=h,this.h()},l(r){t=m(r,"H1",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-5kacpm"&&(t.textContent=e),n=C(r),i=m(r,"SECTION",{class:!0});var l=U(i);a=m(l,"BUTTON",{class:!0,"data-svelte-h":!0}),x(a)!=="svelte-12ba69d"&&(a.textContent=h),l.forEach(u),this.h()},h(){v(t,"class","my-8 md:text-5xl mt-12 px-4 md:px-0 text-3xl font-cursive tracking-tight"),v(a,"class","btn primary"),v(i,"class","px-4 md:px-0")},m(r,l){g(r,t,l),g(r,n,l),g(r,i,l),b(i,a),c||(f=F(a,"click",o[0]),c=!0)},p:d,i:d,o:d,d(r){r&&(u(t),u(n),u(i)),c=!1,f()}}}function K(o){let t,e;_(()=>{t=new AudioContext,e=new z(t)});function n(){t.resume().then(()=>{console.log("Playback resumed successfully"),e.noteOn(60,120)})}return[n]}class Y extends T{constructor(t){super(),R(this,t,K,J,y,{})}}export{Y as component};
