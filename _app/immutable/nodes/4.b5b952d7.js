var k=Object.defineProperty;var C=(c,t,e)=>t in c?k(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var i=(c,t,e)=>(C(c,typeof t!="symbol"?t+"":t,e),e);import{s as v,n as f,o as T}from"../chunks/scheduler.e80da8ef.js";import{S as _,i as b,g as m,s as q,h as d,y,c as A,j as B,f as g,k as p,a as x,x as G,A as S}from"../chunks/index.3d76737d.js";class P{constructor(t,e){i(this,"context");i(this,"tempo");i(this,"numBeats");i(this,"handlers",[]);i(this,"beat",-1);i(this,"bar",0);i(this,"start");i(this,"_tick");this.context=e,this.tempo=t.tempo,this.numBeats=t.numBeats,this.start=this.context.currentTime,this._tick=this.tick.bind(this),this._tick()}add(t){this.handlers.push(t)}tick(){const t=this.context.currentTime,e=t-this.start,n=Math.floor(e*this.tempo/60);n>=this.numBeats?(this.start=t,this.beat=0,this.bar++,this.trigger(t)):this.beat<n&&(this.beat=n,this.trigger(t)),setTimeout(this._tick,0)}trigger(t){const e=this;this.handlers.forEach(function(n){n(t,e.beat,e.bar)})}}class V{constructor(t){i(this,"attack");i(this,"decay");i(this,"sustain");i(this,"release");i(this,"params",null);this.attack=t.attack||.02,this.decay=t.decay||.02,this.sustain=t.sustain||.5,this.release=t.release||.02}connect(t){this.params=this.params||[],this.params.push(t)}disconnect(){this.params=null}play(t,e){var n;(n=this.params)==null||n.forEach(s=>{s.cancelScheduledValues(t),s.setValueAtTime(s.value||0,t),s.linearRampToValueAtTime(1,t+this.attack),s.setValueAtTime(1,t+this.attack),s.linearRampToValueAtTime(this.sustain,t+this.attack+this.decay),s.setValueAtTime(this.sustain,t+e-this.release),s.linearRampToValueAtTime(0,t+e)}),setTimeout(this.disconnect.bind(this),e)}}class z{constructor(t,e){i(this,"context");i(this,"clock");i(this,"staticConfig");i(this,"dynamicConfig");i(this,"osc1gain");i(this,"osc2gain");i(this,"filter");i(this,"pan");i(this,"gain");this.context=e,this.clock=t.clock,this.staticConfig=t.staticConfig,this.dynamicConfig=t.dynamicConfig,this.osc1gain=this.context.createGain(),this.osc2gain=this.context.createGain(),this.filter=this.context.createBiquadFilter(),this.pan=this.context.createPanner(),this.gain=this.context.createGain(),this.configure(),this.staticConfig&&this.staticConfig(),this.connect()}createNodes(){this.osc1gain=this.context.createGain(),this.osc2gain=this.context.createGain(),this.filter=this.context.createBiquadFilter(),this.pan=this.context.createPanner(),this.gain=this.context.createGain()}configure(){this.osc1gain.gain.value=.15,this.osc2gain.gain.value=.1,this.filter.type="lowpass",this.filter.frequency.value=2e3,this.filter.Q.value=4,this.pan.setPosition(0,0,0),this.gain.gain.value=1}connect(){this.osc1gain.connect(this.filter),this.osc2gain.connect(this.filter),this.filter.connect(this.pan),this.pan.connect(this.gain),this.gain.connect(this.context.destination)}play(t,e,n){const s=this.context.createOscillator(),a=this.context.createOscillator(),h=this.context.createGain(),l=this.context.createGain(),r=new V(this.dynamicConfig);s.frequency.value=e,s.type="square",a.frequency.value=e,a.type="sawtooth",a.detune.value=5,s.connect(h),a.connect(l),r.connect(h.gain),r.connect(l.gain),h.connect(this.osc1gain),l.connect(this.osc2gain),s.start(t),a.start(t),s.stop(t+n),a.stop(t+n),r.play(t,n)}}class E{constructor(t,e){i(this,"context");i(this,"clock");i(this,"synthesizer");i(this,"pattern");i(this,"octave");this.context=e,this.clock=t.clock,this.synthesizer=new z({clock:this.clock,staticConfig:t.staticConfig,dynamicConfig:t.dynamicConfig||{}},this.context),this.pattern=t.pattern,this.octave=t.octave,this.clock.add(this.play.bind(this))}play(t,e,n){n=n%this.pattern.length;const s=this.pattern[n];if(!(e>=s.length)&&(e===0||s[e]!==s[e-1])&&s[e]!==" "){const a=this.getFrequency(s[e]),h=this.getDuration(s,e);this.synthesizer.play(t,a,h)}}getFrequency(t){let e;return t==="a"&&(e=10),t==="b"&&(e=11),e=parseInt(t,10),e=this.octave*12+e,440/32*Math.pow(2,(e-9)/12)}getDuration(t,e){const n=t[e];let s=1;for(let a=e+1;a<t.length&&t[a]===n;a++)s++;return s*60/this.clock.tempo}}function F(c){let t,e="Synth",n,s,a,h="Play",l,r;return{c(){t=m("h1"),t.textContent=e,n=q(),s=m("section"),a=m("button"),a.textContent=h,this.h()},l(o){t=d(o,"H1",{class:!0,"data-svelte-h":!0}),y(t)!=="svelte-5kacpm"&&(t.textContent=e),n=A(o),s=d(o,"SECTION",{class:!0});var u=B(s);a=d(u,"BUTTON",{class:!0,"data-svelte-h":!0}),y(a)!=="svelte-12ba69d"&&(a.textContent=h),u.forEach(g),this.h()},h(){p(t,"class","my-8 md:text-5xl mt-12 px-4 md:px-0 text-3xl font-cursive tracking-tight"),p(a,"class","btn primary"),p(s,"class","px-4 md:px-0")},m(o,u){x(o,t,u),x(o,n,u),x(o,s,u),G(s,a),l||(r=S(a,"click",c[0]),l=!0)},p:f,i:f,o:f,d(o){o&&(g(t),g(n),g(s)),l=!1,r()}}}function O(c){let t,e;T(()=>{t=new AudioContext,e=new P({numBeats:12,tempo:90*3},t),new E({clock:e,octave:5,pattern:["888   888555","555   23 555","  55554444 0","444444477777"]},t)});function n(){t.resume().then(()=>{console.log("Playback resumed successfully")})}return[n]}class N extends _{constructor(t){super(),b(this,t,O,F,v,{})}}export{N as component};
